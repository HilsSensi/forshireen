<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catatan Uang Jajan</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font-family:Arial,sans-serif;margin:0;padding:0;background:#f3f4f6;color:#111827}
    header{background:#2563eb;color:#fff;text-align:center;padding:15px;font-size:1.2em;font-weight:bold}
    .container{padding:15px;max-width:480px;margin:auto}
    .card{background:#fff;border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 2px 5px rgba(0,0,0,.1)}
    .summary{display:flex;justify-content:space-between;text-align:center;font-size:.9em}
    .summary div{flex:1;padding:8px}
    .pemasukan{color:#16a34a}.pengeluaran{color:#dc2626}.saldo{color:#2563eb;font-weight:bold}
    table{width:100%;border-collapse:collapse;font-size:.85em}
    table th,table td{border:1px solid #e5e7eb;padding:6px;text-align:center}
    table th{background:#f9fafb}
    button{background:#2563eb;color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;font-size:.85em}
    button:hover{opacity:.9}
    .btn-red{background:#dc2626}.btn-green{background:#16a34a}
    .motivation{font-style:italic;text-align:center;font-size:.9em;color:#4b5563;margin-top:10px}
    .note{font-size:.8em;text-align:center;color:#6b7280;margin-top:4px}
  </style>
</head>
<body>
  <header>ðŸ“Š Catatan Uang Jajan</header>

  <div class="container">
    <!-- Ringkasan -->
    <div class="card summary">
      <div class="pemasukan">Pemasukan<br><span id="totalPemasukan">0</span></div>
      <div class="pengeluaran">Pengeluaran<br><span id="totalPengeluaran">0</span></div>
      <div class="saldo">Saldo<br><span id="saldo">0</span></div>
    </div>
    <div class="note" id="labelBulan">Periode aktif: â€”</div>

    <!-- Pilih Mode -->
    <div class="card">
      <label for="summaryMode">Lihat Ringkasan:</label>
      <select id="summaryMode">
        <option value="harian">Harian</option>
        <option value="mingguan">Mingguan</option>
        <option value="bulanan" selected>Bulanan</option>
      </select>
    </div>

    <!-- Input transaksi -->
    <div class="card">
      <h3>Tambah Transaksi</h3>
      <div style="margin-bottom:8px;">
        <input type="number" id="jumlah" placeholder="Jumlah" style="width:100%;padding:8px;border:1px solid #d1d5db;border-radius:6px;">
      </div>
      <div style="margin-bottom:8px;">
        <input type="text" id="keterangan" placeholder="Keterangan" style="width:100%;padding:8px;border:1px solid #d1d5db;border-radius:6px;">
      </div>
      <div style="margin-bottom:8px;">
        <input type="date" id="tanggalInput" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:6px;">
      </div>
      <div style="display:flex;gap:8px;justify-content:space-between;">
        <button class="btn-green" onclick="tambahTransaksi('pemasukan', jumlah.value, keterangan.value, tanggalInput.value)">+ Pemasukan</button>
        <button class="btn-red"   onclick="tambahTransaksi('pengeluaran', jumlah.value, keterangan.value, tanggalInput.value)">- Pengeluaran</button>
      </div>
      <div style="margin-top:10px;">
        <button onclick="tambahTransaksi('pemasukan',30000,'Uang Jajan Harian',tanggalInput.value)">+ Rp30.000 (Jajan Sekolah)</button>
      </div>
    </div>

    <!-- Filter & Tabel -->
    <div class="card">
      <h3>Riwayat Transaksi</h3>
      <select id="filterTanggal" style="width:100%;padding:6px;margin-bottom:8px;border-radius:6px;"></select>
      <table>
        <thead>
        <tr>
          <th>Tanggal</th><th>Jenis</th><th>Jumlah</th><th>Keterangan</th><th>Aksi</th>
        </tr>
        </thead>
        <tbody id="transaksiBody"></tbody>
      </table>
    </div>

    <!-- Grafik -->
    <div class="card">
      <h3>Grafik Pengeluaran Harian</h3>
      <canvas id="pengeluaranChart"></canvas>
    </div>

    <!-- Motivasi -->
    <div class="motivation" id="motivasi"></div>
  </div>

<script>
  const transaksiKey = "transaksiUangJajan";
  let transaksi = JSON.parse(localStorage.getItem(transaksiKey)) || [];

  const transaksiBody = document.getElementById("transaksiBody");
  const filterTanggal  = document.getElementById("filterTanggal");
  const totalPemasukanEl = document.getElementById("totalPemasukan");
  const totalPengeluaranEl = document.getElementById("totalPengeluaran");
  const saldoEl = document.getElementById("saldo");
  const labelBulanEl = document.getElementById("labelBulan");
  const motivasiEl = document.getElementById("motivasi");
  const summaryMode = document.getElementById("summaryMode");
  const tanggalInput = document.getElementById("tanggalInput");
  const ctx = document.getElementById("pengeluaranChart").getContext("2d");
  let chart;

  tanggalInput.value = new Date().toISOString().split("T")[0];

  const motivasiList = [
    "Elon Musk: Jangan takut gagal, takutlah kalau tidak pernah mencoba.",
    "Warren Buffett: Habiskan lebih sedikit dari yang kamu hasilkan.",
    "Jeff Bezos: Fokus pada pelanggan, bukan pesaing.",
    "Bill Gates: Uang adalah hasil, bukan tujuan.",
    "Mark Cuban: Kerja keras mengalahkan bakat jika bakat tidak bekerja keras.",
    "Steve Jobs: Inovasi membedakan pemimpin dan pengikut.",
    "Oprah Winfrey: Ubah luka menjadi kebijaksanaan.",
    "Jack Ma: Jangan menyerah, hari ini sulit, besok lebih sulit, tapi lusa akan indah.",
    "Larry Page: Selalu berusaha melakukan hal-hal yang sedikit gila.",
    "Sergey Brin: Jangan takut mencoba hal-hal yang tidak biasa."
  ];

  function acakMotivasi(){
    motivasiEl.textContent = "ðŸ’¡ " + motivasiList[Math.floor(Math.random()*motivasiList.length)];
  }

  function simpanData(){ localStorage.setItem(transaksiKey, JSON.stringify(transaksi)); }

  function tambahTransaksi(jenis, jumlah, keterangan, tanggal=null){
    if(!jumlah || isNaN(jumlah)) return;
    const tgl = tanggal || new Date().toISOString().split("T")[0];
    transaksi.push({ jenis, jumlah: parseInt(jumlah), keterangan, tanggal: tgl });
    simpanData(); render();
    document.getElementById("jumlah").value = "";
    document.getElementById("keterangan").value = "";
  }

  function hapusTransaksi(index){ transaksi.splice(index,1); simpanData(); render(); }

  function renderFilterTanggal(){
    const tanggalUnik = [...new Set(transaksi.map(t=>t.tanggal))].sort((a,b)=>b.localeCompare(a));
    filterTanggal.innerHTML = '<option value="">Semua Tanggal</option>';
    tanggalUnik.forEach(tgl=>{
      const opt=document.createElement("option"); opt.value=tgl; opt.textContent=tgl; filterTanggal.appendChild(opt);
    });
  }

  function getStartOfWeek(date) {
    const d = new Date(date);
    const day = d.getDay();
    const diff = d.getDate() - day + (day === 0 ? -6 : 1);
    return new Date(d.setDate(diff));
  }

  function updateSummary(){
    let totalPemasukan=0, totalPengeluaran=0;
    const today=new Date();

    if(summaryMode.value==="bulanan"){
      const bulan=today.toISOString().slice(0,7);
      transaksi.filter(t=>t.tanggal.startsWith(bulan)).forEach(t=>{
        if(t.jenis==="pemasukan") totalPemasukan+=t.jumlah;
        else totalPengeluaran+=t.jumlah;
      });
      labelBulanEl.textContent="Periode aktif: Bulan ini";

    }else if(summaryMode.value==="mingguan"){
      const start=getStartOfWeek(today);
      const end=new Date(start); end.setDate(end.getDate()+6);
      transaksi.forEach(t=>{
        const tgl=new Date(t.tanggal);
        if(tgl>=start && tgl<=end){
          if(t.jenis==="pemasukan") totalPemasukan+=t.jumlah;
          else totalPengeluaran+=t.jumlah;
        }
      });
      labelBulanEl.textContent="Periode aktif: Mingguan (Senin-Minggu)";

    }else if(summaryMode.value==="harian"){
      const hariIni=today.toISOString().split("T")[0];
      transaksi.filter(t=>t.tanggal===hariIni).forEach(t=>{
        if(t.jenis==="pemasukan") totalPemasukan+=t.jumlah;
        else totalPengeluaran+=t.jumlah;
      });
      labelBulanEl.textContent="Periode aktif: Hari ini";
    }

    totalPemasukanEl.textContent=totalPemasukan.toLocaleString("id-ID");
    totalPengeluaranEl.textContent=totalPengeluaran.toLocaleString("id-ID");
    saldoEl.textContent=(totalPemasukan-totalPengeluaran).toLocaleString("id-ID");
  }

  function updateChart(dataHarian){
    const pengeluaranKategori={};
    dataHarian.forEach(t=>{
      if(t.jenis==="pengeluaran"){
        pengeluaranKategori[t.keterangan]=(pengeluaranKategori[t.keterangan]||0)+t.jumlah;
      }
    });
    const labels=Object.keys(pengeluaranKategori);
    const data=Object.values(pengeluaranKategori);
    if(chart) chart.destroy();
    chart=new Chart(ctx,{type:"pie",data:{labels,datasets:[{data,backgroundColor:["#f87171","#60a5fa","#34d399","#fbbf24","#a78bfa","#f472b6"]}]}})
  }

  function render(){
    transaksiBody.innerHTML="";
    const filter=filterTanggal.value;
    const dataFilter = filter ? transaksi.filter(t=>t.tanggal===filter) : transaksi;

    dataFilter.forEach((t,idx)=>{
      const row=document.createElement("tr");
      row.innerHTML=`
        <td>${t.tanggal}</td>
        <td>${t.jenis}</td>
        <td>${t.jumlah.toLocaleString('id-ID')}</td>
        <td>${t.keterangan}</td>
        <td><button class="btn-red" onclick="hapusTransaksi(${idx})">X</button></td>
      `;
      transaksiBody.appendChild(row);
    });

    updateSummary();
    if(filter){
      const dataHarian = transaksi.filter(t=>t.tanggal===filter);
      updateChart(dataHarian);
    }else{
      updateChart([]);
    }
    renderFilterTanggal();
  }

  filterTanggal.addEventListener("change", render);
  summaryMode.addEventListener("change", render);

  render();
  acakMotivasi();
</script>
</body>
</html>